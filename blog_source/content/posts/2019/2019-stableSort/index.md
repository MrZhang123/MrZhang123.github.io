---
title: ã€Œè¯‘ã€ç¨³å®šçš„Array.prototype.sort
date: 2019-07-08 23:10:00
tags:
  - JavaScript
categories:
  - JavaScript
draft: false
---

åŸæ–‡é“¾æ¥ï¼šhttps://v8.dev/features/stable-sort#support

å‡è®¾ä½ æœ‰ä¸€ç³»åˆ—çš„ç‹—ç‹—ï¼Œæ¯ä¸ªç‹—ç‹—æœ‰åå­—å’Œè¯„åˆ†ã€‚ï¼ˆå¦‚æœè¿™ä¸ªä¾‹å­çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½ åº”è¯¥çŸ¥é“æœ‰ä¸€ä¸ªä¸“é—¨é’ˆå¯¹è¿™ä¸ªçš„Twitterè´¦æˆ·...åˆ«é—®ä¸ºä»€ä¹ˆï¼ï¼‰
<!--more-->
```js
// Note:æŒ‰å­—æ¯é¡ºåºè¿›è¡Œé¢„æ’åº
const doggos = [
  { name: 'Abby',   rating: 12 },
  { name: 'Bandit', rating: 13 },
  { name: 'Choco',  rating: 14 },
  { name: 'Daisy',  rating: 12 },
  { name: 'Elmo',   rating: 12 },
  { name: 'Falco',  rating: 13 },
  { name: 'Ghost',  rating: 14 },
];
// æŒ‰ç…§`rating`æŠŠç‹—ç‹—è¿›è¡Œé™åºæ’åº
// ï¼ˆè¿™ä¼šæ›´æ–°doggosï¼‰
doggos.sort((a, b) => b.rating - a.rating);
```
æ•°æ®æŒ‰ç…§å­—æ¯é¡ºåºä¸æ’åºã€‚ä¸ºäº†æŒ‰ç…§è¯„åˆ†æ’åºï¼ˆæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆå¾—åˆ°è¯„åˆ†æœ€é«˜çš„ç‹—ç‹—ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨`Array#sort`ï¼Œä¼ é€’ä¸€ä¸ªæ¯”è¾ƒè¯„åˆ†çš„è‡ªå®šä¹‰å›è°ƒã€‚æ’åºåçš„ç»“æœå¦‚ä¸‹ï¼š

```js
[
  { name: 'Choco',  rating: 14 },
  { name: 'Ghost',  rating: 14 },
  { name: 'Bandit', rating: 13 },
  { name: 'Falco',  rating: 13 },
  { name: 'Abby',   rating: 12 },
  { name: 'Daisy',  rating: 12 },
  { name: 'Elmo',   rating: 12 },
]
```
ç‹—ç‹—æŒ‰ç…§è¯„åˆ†æ’åºï¼Œä½†æ˜¯åœ¨æ¯ä¸ªè¯„åˆ†å†…ï¼Œå®ƒä»¬ä¾ç„¶æŒ‰ç…§åå­—çš„å­—æ¯çš„é¡ºåºæ’åºã€‚ä¾‹å¦‚ï¼ŒChocoå’ŒGhostçš„è¯„åˆ†éƒ½æ˜¯14ï¼Œä½†æ˜¯åœ¨æ’åºç»“æœä¸­Chocoåœ¨Ghostçš„å‰é¢ï¼Œå› ä¸ºè¿™ä¹Ÿæ˜¯å®ƒä»¬åœ¨åŸå§‹æ•°æ®ä¸­çš„é¡ºåºã€‚

ä½†æ˜¯è¦å¾—åˆ°è¿™ä¸ªç»“æœï¼ŒJavaScriptå¼•æ“ä¸èƒ½åªä½¿ç”¨ä»»ä½•æ’åºç®—æ³•â€”â€”æ’åºç®—æ³•å¿…é¡»æ˜¯â€œç¨³å®šçš„æ’åºâ€ã€‚å¾ˆé•¿æ—¶é—´é‡Œï¼ŒJavaScriptè§„èŒƒå¹¶ä¸è¦æ±‚`Array#sort`è¿›è¡Œæ’åºçš„ç¨³å®šæ€§ï¼Œè€Œæ˜¯å°†å…¶ç•™ç»™å®ç°è¿‡ç¨‹ã€‚å› ä¸ºè¿™ç§è¡Œä¸ºæ²¡æœ‰å…·ä½“è¯´æ˜ï¼Œæ‰€ä»¥ä½ å¯èƒ½å¾—åˆ°çš„Ghostæ’åœ¨Chocoå‰é¢çš„æ’åºç»“æœã€‚

```js
[
  { name: 'Ghost',  rating: 14 }, // ğŸ˜¢
  { name: 'Choco',  rating: 14 }, // ğŸ˜¢
  { name: 'Bandit', rating: 13 },
  { name: 'Falco',  rating: 13 },
  { name: 'Abby',   rating: 12 },
  { name: 'Daisy',  rating: 12 },
  { name: 'Elmo',   rating: 12 },
]
```

æ¢å¥è¯è¯´ï¼ŒJavaScriptå¼€å‘è€…ä¸èƒ½ä¾èµ–æ’åºçš„ç¨³å®šæ€§ã€‚åœ¨å®è·µä¸­ï¼Œæƒ…å†µå¯èƒ½æ›´ä»¤äººæ„¤æ€’ï¼Œå› ä¸ºæœ‰äº›JavaScriptå¼•æ“å¯¹çŸ­æ•°ç»„è¿›è¡Œç¨³å®šæ’åºè€Œå¯¹é•¿æ•°ç»„è¿›è¡Œä¸ç¨³å®šæ’åºã€‚è¿™è®©äººéå¸¸å›°æƒ‘ï¼Œå¼€å‘è€…åœ¨æµ‹è¯•ä»–ä»¬çš„ä»£ç æ—¶å€™ï¼Œçœ‹åˆ°çš„æ˜¯ç¨³å®šçš„æ’åºï¼Œä½†æ˜¯å½“æ•°ç»„ç•¥å¤§çš„æ—¶å€™ï¼Œçªç„¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è·å¾—ä¸ç¨³å®šæ’åºçš„ç»“æœã€‚

ä½†æ˜¯æœ‰ä¸€äº›å¥½æ¶ˆæ¯ã€‚æˆ‘ä»¬[æå‡ºè§„èŒƒå˜æ›´](https://github.com/tc39/ecma262/pull/1340)ï¼Œè®©`Array#sort`å˜å¾—ç¨³å®šï¼Œå¹¶ä¸”è¢«æ¥å—ã€‚ç°åœ¨ï¼Œæ‰€æœ‰çš„JavaScriptä¸»æµå¼•æ“éƒ½å®ç°äº†ç¨³å®šçš„`Array#sort`ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œåªéœ€è¦æ‹…å¿ƒä¸€ä»¶äº‹æƒ…ï¼Œå¤ªå¥½äº†ï¼

ï¼ˆæˆ‘ä»¬åšäº†åŒæ ·çš„äº‹æƒ…ä¸º`TypedArrays`ï¼šå®ƒçš„sortç°åœ¨ä¹Ÿç¨³å®šäº†ï¼‰

>å°½ç®¡ç°åœ¨æ¯ä¸ªè§„èŒƒéƒ½è¦æ±‚ç¨³å®šï¼ŒJavaScriptå¼•æ“ä¾ç„¶å¯ä»¥è‡ªç”±çš„å®ç°å®ƒä»¬æƒ³è¦çš„æ’åºç®—æ³•ã€‚ä¾‹å¦‚[V8ä½¿ç”¨çš„Timsort](https://v8.dev/blog/array-sort#timsort)ã€‚è¯¥è§„èŒƒå¹¶ä¸è¦æ±‚ä»»ä½•ç‰¹å®šçš„æ’åºç®—æ³•ã€‚

è¯‘è€…æ³¨ï¼š
Timsortç®—æ³•æ˜¯éå¸¸æœ‰åçš„ä¸€ä¸ªç®—æ³•ï¼Œåœ¨ä¿è¯é«˜æ€§èƒ½çš„åŒæ—¶è¿˜èƒ½ä¿è¯æ€§èƒ½ç¨³å®šã€‚
TimSortçš„è®¾è®¡æ€è·¯å¾ˆæ–°é¢–ï¼ˆå½“ç„¶ä¹Ÿå¯èƒ½å€Ÿé‰´äº†å…¶ä»–ç®—æ³•ï¼‰ï¼šæ—¢ç„¶å•ä¸ªç®—æ³•ä¼šé‡åˆ°æœ€å¥½æƒ…å†µå’Œæœ€å·®æƒ…å†µå¯¼è‡´æ€§èƒ½ä¸ç¨³å®šï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯å¯ä»¥å…ˆåˆ†ææ•°ç»„ç‰¹å¾ï¼Œç„¶åæ‰¬é•¿é¿çŸ­åœ¨å¤šç§ç®—æ³•ä¸­é€‰å–åˆé€‚çš„ç®—æ³•è¿›è¡Œæ’åºå‘¢ï¼Ÿ
æ‰€ä»¥å®é™…ä¸ŠTimSortæ˜¯å¤šç§æ’åºç®—æ³•+åˆ†å—ç®—æ³•+ç¿»è½¬ï¼Œæ˜¯ä¸€ç§â€œæ··åˆæ’åºç®—æ³•è°ƒåº¦ç®—æ³•â€ã€‚
æœ‰å¾ˆå¤šè¯­è¨€å¼•æ“é»˜è®¤ä½¿ç”¨TimSortä½œä¸ºåŸç”Ÿæ’åºç®—æ³•ï¼Œå¦‚Pythonï¼ˆ2.3å¼€å§‹ï¼‰ã€Java SE 7ã€Android platformã€GNU Octaveã€‚

## ç‰¹æ€§æ”¯æŒ

### ç¨³å®šçš„`Array.prototype.sort`

* [Chrome 70+](https://v8.dev/blog/v8-release-70#javascript-language-features)
* Firefoxæ··åˆæ”¯æŒ
* Safariæ··åˆæ”¯æŒ
* [Node 12+](https://twitter.com/mathias/status/1120700101637353473)
* ~~Babel~~

### ç¨³å®šçš„`%TypedArray%.prototype.sort`

* [Chrome 74+](https://bugs.chromium.org/p/v8/issues/detail?id=8567)
* [Firefox 67+](https://bugzilla.mozilla.org/show_bug.cgi?id=1290554)
* Safariæ··åˆæ”¯æŒ
* [Node 12+](https://twitter.com/mathias/status/1120700101637353473)
* ~~Babel~~
