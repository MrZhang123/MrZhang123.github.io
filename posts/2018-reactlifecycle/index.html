<!DOCTYPE html>
<html lang='zh' ><meta charset="utf-8">
<meta name="viewport" content="width=device-width">


<title>「译」如何使用React生命周期方法 | 博客</title>

<meta name="generator" content="Hugo Eureka 0.8.3-dev" />
<link rel="stylesheet" href="/css/eureka.min.css">
<script defer src="/js/eureka.min.js"></script>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
  href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap"
  as="style" onload="this.onload=null;this.rel='stylesheet'">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/solarized-light.min.css"
   media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js"
   crossorigin></script>

<script defer src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js"
   integrity="sha256-uNYoXefWRqv&#43;PsIF/OflNmwtKM4lStn9yrz2gVl6ymo="  crossorigin></script>









<meta name="description"
  content="
原文链接：How to use React Lifecycle Methods
">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1 ,
      "name":"文章",
      "item":"/posts/"},{
      "@type": "ListItem",
      "position": 2 ,
      "name":"「译」如何使用React生命周期方法",
      "item":"/posts/2018-reactlifecycle/"}]
}
</script>



<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/posts/2018-reactlifecycle/"
    },
    "headline": "「译」如何使用React生命周期方法 | 博客","datePublished": "2018-07-28T13:39:28+00:00",
    "dateModified": "2018-07-28T13:39:28+00:00",
    "wordCount":  151 ,
    "publisher": {
        "@type": "Person",
        "name": "博客",
        },
    "description": "\u003cblockquote\u003e\n\u003cp\u003e原文链接：\u003ca href=\u0022https:\/\/www.andreasreiterer.at\/reactjs-lifecycle-methods\/\u0022\u003eHow to use React Lifecycle Methods\u003c\/a\u003e\u003c\/p\u003e\n\u003c\/blockquote\u003e"
}
</script><meta property="og:title" content="「译」如何使用React生命周期方法 | 博客" />
<meta property="og:type" content="article" />



<meta property="og:url" content="/posts/2018-reactlifecycle/" />




<meta property="og:description" content="
原文链接：How to use React Lifecycle Methods
" />




<meta property="og:locale" content="zh" />




<meta property="og:site_name" content="博客" />






<meta property="article:published_time" content="2018-07-28T13:39:28&#43;00:00" />


<meta property="article:modified_time" content="2018-07-28T13:39:28&#43;00:00" />



<meta property="article:section" content="posts" />


<meta property="article:tag" content="React" />





<meta property="og:see_also" content="/posts/2018-reactproject2/" />

<meta property="og:see_also" content="/posts/2018-reactproject1/" />

<meta property="og:see_also" content="/posts/2018-reactcssmodules/" />

<meta property="og:see_also" content="/posts/2017-reactsum/" />



<body class="flex flex-col min-h-screen">
  <header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm">
    <div class="w-full max-w-screen-xl mx-auto"><script>
    let storageColorScheme = localStorage.getItem("lightDarkMode")
    if (((storageColorScheme == 'Auto' || storageColorScheme == null) && window.matchMedia("(prefers-color-scheme: dark)").matches) || storageColorScheme == "Dark") {
        document.getElementsByTagName('html')[0].classList.add('dark')
    }
</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
    <a href="/" class="mr-6 text-primary-text text-xl font-bold">博客</a>
    <button id="navbar-btn" class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
        <i class="fas fa-bars"></i>
    </button>

    <div id="target"
        class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="md:flex md:h-16 text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0">
        </div>

        <div class="flex">
            <div class="relative pt-4 md:pt-0">
                <div class="cursor-pointer hover:text-eureka" id="lightDarkMode">
                    <i class="fas fa-adjust"></i>
                </div>
                <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
                </div>
                <div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40"
                    id='lightDarkOptions'>
                    <span class="px-4 py-1 hover:text-eureka" name="Light">浅色</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Dark">深色</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Auto">自动</span>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    
    let element = document.getElementById('lightDarkMode')
    if (storageColorScheme == null || storageColorScheme == 'Auto') {
        document.addEventListener('DOMContentLoaded', () => {
            window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change', switchDarkMode)
        })
    } else if (storageColorScheme == "Light") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'sun')
        element.firstElementChild.classList.add('fa-sun')
    } else if (storageColorScheme == "Dark") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'moon')
        element.firstElementChild.classList.add('fa-moon')
    }

    document.addEventListener('DOMContentLoaded', () => {
        getcolorscheme();
        switchBurger();
    });
</script>
</div>
  </header>
  <main class="flex-grow pt-16">
    <div class="pl-scrollbar">
      <div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto">


<div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12">
    <div
        class="col-span-2 lg:col-start-2 lg:col-span-6 bg-secondary-bg rounded px-6 py-8">
        <h1 class="font-bold text-3xl text-primary-text">「译」如何使用React生命周期方法</h1>
        <div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text">
    <div class="mr-6 my-2">
        <i class="fas fa-calendar mr-1"></i>
        <span>2018-07-28</span>
    </div>
    <div class="mr-6 my-2">
        <i class="fas fa-clock mr-1"></i>
        <span>1分钟阅读时长</span>
    </div>
    
    
    <div class="mr-6 my-2">
        <i class="fas fa-folder mr-1"></i>
        
        <a href="/categories/react/" class="hover:text-eureka">React</a>
        
    </div>
    

    
</div>
        
        
        

        <div class="content">
            <blockquote>
<p>原文链接：<a href="https://www.andreasreiterer.at/reactjs-lifecycle-methods/">How to use React Lifecycle Methods</a></p>
</blockquote>
<h2 id="react-生命周期">React 生命周期</h2>
<p>大体上分三类</p>
<ul>
<li>Mount</li>
<li>Update</li>
<li>Unmount</li>
</ul>
<h3 id="mount">Mount</h3>
<ul>
<li><em>constructor()</em></li>
<li><em><del>componentWillMount()</del></em></li>
<li><em>render()</em></li>
<li><em>componentDidMount()</em></li>
</ul>
<h3 id="update">Update</h3>
<ul>
<li><em><del>componentWillReceiveProps()</del> / static getDerivedStateFromProps()</em></li>
<li><em>shouldComponentUpdate()</em></li>
<li><em><del>componentWillUpdate()</del> / getSnapshotBeforeUpdate()</em></li>
<li><em>render()</em></li>
<li><em>componentDidUpdate()</em></li>
</ul>
<h3 id="unmount">Unmount</h3>
<ul>
<li><em>componentWillUnmount()</em></li>
</ul>
<h2 id="生命周期方法">生命周期方法</h2>
<h3 id="componentwillmount即将移除">componentWillMount（即将移除）</h3>
<pre><code class="language-javascript">componentWillMount()
</code></pre>
<p>当 React 渲染一个组件的是你，首先进入该方法。</p>
<p><strong>Note：</strong><code>componentWillMount()</code>是唯一一个在<code>render()</code>之前调用的生命周期方法。因此是在服务端渲染中唯一被调用的方法。</p>
<p>因为<code>componentWillMount()</code>将被删除，所以官方推荐使用<code>constructor()</code>替代该方法</p>
<p>**Update：**该方法应该在新的代码中避免使用</p>
<h4 id="state">State</h4>
<p>可以在该方法中使用<code>this.setState()</code>但是不一定触发重新渲染。</p>
<h3 id="componentdidmount">componentDidMount</h3>
<pre><code class="language-javascript">componentDidMount()
</code></pre>
<p>当该方法被调用时候，React 已经渲染了组件并且将组件插入 DOM。因此如有有任何依赖于 DOM 的初始化，应该放在这里。</p>
<h4 id="state-1">State</h4>
<p>该方法中可以使用<code>this.setState()</code>方法，它将触发重新渲染。</p>
<h4 id="use-cases">Use Cases</h4>
<ul>
<li>fetch data</li>
<li>依赖 DOM 初始化</li>
<li>添加事件监听</li>
</ul>
<h3 id="componentwillreceiveprops即将移除">componentWillReceiveProps（即将移除）</h3>
<pre><code class="language-javascript">componentWillReceiveProps(nextProps)
</code></pre>
<p>当组件接收到新的<code>props</code>，该方法会首先被调用，但是需要注意一点，<strong>即使<code>props</code>并没有发生改变，该方法也会被调用</strong>，所以使用该方法的时候要确保比较<code>this.props</code>和<code>nextProps</code>，避免不必要的渲染。</p>
<p><strong>Update：</strong><code>componentWillReceiveProps</code>将被移除，使用新的<code>static getDerivedStateFromProps</code>代替。</p>
<h3 id="static-getderivedstatefromprops新增">static getDerivedStateFromProps（新增）</h3>
<pre><code class="language-javascript">static getDerivedStateFromProps(props, state)
</code></pre>
<p>每次<code>render</code>都会调用该方法——即使<code>props</code>没有发生变化。<strong>所以要谨慎使用。</strong></p>
<h3 id="shouldcomponentupdate">shouldComponentUpdate</h3>
<pre><code class="language-javascript">shouldComponentUpdate(nextState, nextProps)
</code></pre>
<p>有些时候需要避免不必要的渲染，可以使用该方法。返回<code>false</code>意味着 React 不执行<code>componentWillUpdate()</code>，<code>render()</code>，<code>componentDidUpdate()</code>。</p>
<p>该方法在初始化时候不执行。</p>
<p>**Note：**根据 React 文档，React 可能将<code>shouldComponentUpdate</code>视做提示而不是严格的根据它的返回结果决定是否执行，也就是说可能出现<code>shouldComponentUpdate</code>返回<code>false</code>，但是还是发生重新渲染。</p>
<h4 id="state-2">State</h4>
<p>在该方法中不可以设置<code>setState</code>。</p>
<h4 id="use-case">Use Case</h4>
<p>如前所述，该方法可能有有问题。React 官方提供了另一个解决办法，所以如果发现某个组件慢，可以使用<code>React.PureComponent</code>替代<code>React.component</code>，它将对<code>props</code>和<code>state</code>提供一个浅层对照。</p>
<h3 id="componentwillupdate即将移除">componentWillUpdate（即将移除）</h3>
<pre><code class="language-javascript">componentWillUpdate(nextProps, nextState)
</code></pre>
<p>该方法在被渲染前调用。<code>shouldComponentUpdate</code>在新的<code>props</code>进入组件或者<code>state</code>改变的时候调用。</p>
<p>该方法在初始渲染时候不被调用。</p>
<p><strong>Update：</strong><code>shouldComponentUpdate</code>即将被移除。</p>
<h4 id="state-3">State</h4>
<p>在该方法中不能调用<code>setState</code>。</p>
<h4 id="use-cases-1">Use Cases</h4>
<p><code>shouldComponentUpdate</code>方法在<code>render()</code>前会被准确调用，所以在该方法中做任何跟 DOM 相关的操作是不合适的，因为很快会过期。</p>
<p>常见的用例有：</p>
<ul>
<li>根据<code>state</code>的变化设置变量</li>
<li>派发事件</li>
<li>开始动画</li>
</ul>
<h3 id="getsnapshotbeforeupdate">getSnapshotBeforeUpdate</h3>
<pre><code class="language-javascript">getSnapshotBeforeUpdate(prevProps, prevState)
</code></pre>
<p>该方法在 React 16.3 被添加并且它配合<code>componentDidUpdate</code>。该方法应该覆盖了旧方法<code>shouldComponentUpdate</code>的所有用例。</p>
<p><code>getSnapshotBeforeUpdate</code>在元素被渲染并写入 DOM 之前调用，这样，你在 DOM 更新前捕获 DOM 信息（例如：滚动位置）。</p>
<p>应该返回一个<code>snapshot</code>值或<code>null</code>，无论返回什么，<code>shouldComponentUpdate</code>都可以接收到<code>snapshot</code>参数。</p>
<h4 id="use-cases-2">Use Cases</h4>
<p>如果想要获得一个 list 或者一个聊天窗口中的滚动位置，可以在<code>getSnapshotBeforeUpdate</code>中取到这些信息。然后将滚动信息作为<code>snapshot</code>值返回。这允许在<code>shouldComponentUpdate</code>中是设置正确的滚动位置在 DOM 更新后。</p>
<h3 id="componentdidupdate">componentDidUpdate</h3>
<pre><code class="language-javascript">componentDidUpdate(prevProps, prevState, snapshot)
</code></pre>
<p>React 更新组件后，调用<code>componentDidUpdate</code>。该方法在初始渲染时候不会被调用。</p>
<h4 id="use-cases-3">Use Cases</h4>
<p>如果组件更新后需要操作 DOM，可以使用该方法。</p>
<h3 id="componentwillunmount">componentWillUnmount</h3>
<pre><code class="language-javascript">componentWillUnmount()
</code></pre>
<p>在卸载，销毁组件之前调用该方法。</p>
<h4 id="state-4">State</h4>
<p>在卸载组件时候不能设置 State</p>
<h4 id="use-cases-4">Use Cases</h4>
<p>使用该方法清理 actions。</p>
<ul>
<li>删除在<code>componentDidMount</code>或其他地方添加的事件监听</li>
<li>断开网络请求</li>
<li>清空计时器</li>
<li>清理在<code>componentDidMount</code>中创建的 DOM 元素</li>
</ul>
        </div>
        
        <div class="my-4">
    
    <a href="/tags/react/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#React</a>
    
</div>
        
        
        


        
        
        
        
<div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t">
    <div>
        
        <span class="block font-bold">上一页</span>
        <a href="/posts/2018-2019newyear/" class="block">再见2018，你好2019</a>
        
    </div>
    <div class="md:text-right mt-4 md:mt-0">
        
        <span class="block font-bold">下一页</span>
        <a href="/posts/2018-reactproject2/" class="block">从零开始搭建React应用（二）——React应用架构</a>
        
    </div>
</div>

        



    </div>
    

    
    
    <div
        class="col-span-2 lg:col-start-2 lg:col-span-6 bg-secondary-bg rounded p-6">
        <h2 class="text-lg font-semibold mb-4">相关</h2>
        <div class="content">
            
            <a href="/posts/2018-reactproject2/">从零开始搭建React应用（二）——React应用架构</a>
            <br />
            
            <a href="/posts/2018-reactproject1/">从零开始搭建React应用（一）——基础搭建</a>
            <br />
            
            <a href="/posts/2018-reactcssmodules/">CSS Modules在React中的应用</a>
            <br />
            
            <a href="/posts/2017-reactsum/">React使用小记</a>
            <br />
            
        </div>
    </div>
    
</div>
<script>
    document.addEventListener('DOMContentLoaded', ()=>{
        hljs.initHighlightingOnLoad();
    })
</script>

      </div>
    </div>
    
  </main>
  <footer class="pl-scrollbar">
    <div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b">
    <p class="text-sm text-tertiary-text">&copy; 2021 <a href="https://www.wangchucheng.com/">C. Wang</a> and <a href="https://www.ruiqima.com/">R. Ma</a>
 &middot;  Powered by the <a href="https://github.com/wangchucheng/hugo-eureka" class="hover:text-eureka">Eureka</a> theme for <a href="https://gohugo.io" class="hover:text-eureka">Hugo</a></p>
</div></div>
  </footer>
</body>

</html>